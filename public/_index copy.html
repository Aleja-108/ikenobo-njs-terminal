<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>IKENOBO - Admin</title>
  <link rel="stylesheet" href="style/style.css" />
  <link rel="icon" type="image/svg+xml" href="img/favicon_io (3)/favicon.ico" />
</head>
<body>

<!-- HEADER -->
<header>
  <img src="img/ikenobo_logo.png" alt="IKENOBO" id="logo"/>
  <h1>IKENOBO - Productos</h1>
  <button id="toggleMode" onclick="toggleMode()">Modo Claro / Oscuro</button>
</header>

<!-- LOGIN -->
<section class="card">
  <h2>Login Admin</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Iniciar sesiÃ³n</button>
  <button onclick="logout()" class="secondary">Cerrar sesiÃ³n</button>
  <p id="tokenBox">Token no generado aÃºn</p>
</section>

<!-- CREAR PRODUCTO -->
<section class="card">
  <h2>Crear producto</h2>
  <input id="name" placeholder="Nombre" />
  <input id="productID" type="number" placeholder="productID" />
  <input id="price" type="number" placeholder="Precio" />
  <input id="image" placeholder="Imagen (URL)" />
  <textarea id="description" placeholder="DescripciÃ³n..."></textarea>
  <button onclick="crearProducto()">Crear</button>
</section>

<!-- TABLA DE PRODUCTOS -->
<section class="card">
  <h2>Productos</h2>
  <button onclick="traerProductos()">Ver lista</button>
  <input id="searchID" placeholder="Buscar productID" />
  <button onclick="buscarProducto()">Buscar</button>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Imagen</th>
        <th>Nombre</th>
        <th>Precio</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="tabla"></tbody>
  </table>
</section>

<script>
  const URL = "http://localhost:3000/api";
  let token = "";

  async function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    const res = await fetch(`${URL}/auth/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();
    token = data.token;
    document.getElementById("tokenBox").innerText = "Token: " + token;
  }

  function logout() {
    token = "";
    document.getElementById("tokenBox").innerText = "Token no generado aÃºn.";
  }

  async function crearProducto() {
    const body = {
      name: document.getElementById("name").value,
      productID: document.getElementById("productID").value,
      price: document.getElementById("price").value,
      image: document.getElementById("image").value,
      description: document.getElementById("description").value,
    };

    await fetch(`${URL}/products/create`, {
      method: "POST",
      headers: { "Content-Type": "application/json", Authorization: token },
      body: JSON.stringify(body)
    });
    traerProductos();
  }

  async function traerProductos() {
    const res = await fetch(`${URL}/products`);
    const data = await res.json();

    const tabla = document.getElementById("tabla");
    tabla.innerHTML = "";
    data.forEach(p => {
      tabla.innerHTML += `
        <tr>
          <td>${p.productID}</td>
          <td><img src="${p.image || ''}" width="50"></td>
          <td>${p.name}</td>
          <td>${p.price}</td>
          <td><button onclick="eliminarProducto('${p.productID}')">X</button></td>
        </tr>`;
    });
  }

  async function eliminarProducto(id) {
    await fetch(`${URL}/products/${id}`, {
      method: "DELETE",
      headers: { Authorization: token }
    });
    traerProductos();
  }

  async function buscarProducto() {
    const id = document.getElementById("searchID").value;
    const res = await fetch(`${URL}/products/${id}`);
    console.log(await res.json());
  }

  // ðŸŒ“ MODO OSCURO / CLARO
  function toggleMode() {
    document.body.classList.toggle("light");
  }
</script>
</body>
</html>
